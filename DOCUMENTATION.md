# EduLearn AI Python Server - Documentation

## Project Overview
The **EduLearn AI Python Server** is a specialized backend service designed to handle AI-intensive tasks such as Exam Generation (RAG), Intelligent Writing Tutoring, and Document Digitization. It complements the main NestJS server by providing dedicated endpoints for Large Language Model (LLM) processing, OCR, and real-time Socket.IO communication.

---

## 1. System Pipeline & Architecture

### A. AI Exam Generation (RAG)
1. **Document Upload**: User uploads a `.docx` or `.pdf` file.
2. **Text Extraction & Chunking**: The server extracts content and splits it into manageable semantic chunks.
3. **Retrieval**: When generating a test, the system retrieves relevant chunks based on the specified topic or difficulty.
4. **LLM Generation**: Using OpenAI (GPT-4o/GPT-3.5) or local LLMs (Ollama), the system generates multiple-choice questions with correct answers and explanations.
5. **Persistence**: Questions and Tests are stored in the MySQL database (shared context via environment variables).

### B. Writing Chat Bot (Intelligent Tutor)
1. **Context Initialization**: The student selects a topic (e.g., "Airport Customs"), language, and difficulty.
2. **Dialogue Generation**: AI generates a full dialogue structure.
3. **Interactive Practice**: The student responds to each part of the dialogue.
4. **Real-time Feedback**: Not currently in the Python server but designed to allow future integration for scoring and corrections.

### C. Digital Document Processing
1. **Word to LaTeX**: High-fidelity conversion of Word documents to LaTeX formatting.
2. **AI-OCR & Table Extraction**: Uses specialized models to extract complex mathematical formulas and nested tables.
3. **Structured Output**: Generates a JSON representation of the document structure, ready for importing into the CMS.
4. **Media Management**: Images extracted from documents are automatically uploaded to Cloudflare R2 and replaced with public URLs.

---

## 2. Implementation & Execution Guide

### Prerequisites
- Python 3.10+
- MySQL Server
- OpenAI API Key
- Cloudflare R2 Credentials

### Installation
1. Clone the repository.
2. Create a virtual environment: `python -m venv venv`.
3. Activate venv: `source venv/bin/activate` (Linux) or `venv\Scripts\activate` (Windows).
4. Install dependencies: `pip install -r requirements.txt`.
5. Configure `.env` file with Database and API keys.

### Running the Server
```bash
python main.py
```
The server will start on `http://localhost:5000` (default) and documentation is available at `http://localhost:5000/docs`.

---

## 3. Security Architecture

Detailed security measures implemented in this project:

### A. Input Sanitization & Validation
- All file uploads are restricted by extension (`.doc`, `.docx`, `.pdf`).
- Filenames are secured using `werkzeug.utils.secure_filename` to prevent directory traversal attacks.
- JSON body inputs are strictly validated against schemas in the controllers.

### B. Database Security
- Use of parameterized queries via `execute_query` to prevent SQL Injection.
- Environment variables are used for all database credentials (never hardcoded).

### C. Real-time Security (Socket.IO)
- **Attempt Tracking**: Unique `attemptId` is required for all real-time exam events.
- **Heartbeat & Expiry**: Server-side expiration tracking for exams. If the student stays inactive or the time runs out, the attempt is force-submitted.
- **Violation Logging**: Comprehensive logging of suspicious activities (Tab switching, Fullscreen exit) stored in JSON format for audit.

### D. Media Security
- Private Cloudflare R2 tokens are stored on the server side.
- Media is served via a public bucket URL with randomized/timestamped filenames to prevent content enumeration.

---

## 4. API Reference (Flasgger)

### Modules:
- **Health**: `/api/health` - Check system status.
- **AI Exam**: `/api/ai-exam` - RAG-based test generation and management.
- **Exam Attempt**: `/api/exams/attempt` - Real-time exam session handling.
- **Writing**: `/api/writing-chat-bot` - AI Tutor dialogue generation.
- **Digital Document**: `/api/digital-document` - Word to JSON/LaTeX conversion.
- **Files**: `/api/files` - General dataset file management.

---

*Generated by Antigravity AI for EduLearn Project.*
